<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PARRILLADAS FAMILIARES</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f6f5f3, #042490); margin: 0; min-height: 100vh; display: flex; justify-content: center; }
  .form-box { background: #fff; border-radius: 12px; width: 95%; max-width: 800px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); margin: 20px 0; }
  .nav { display: flex; justify-content: space-around; background: #042490; padding: 10px; }
  .nav-btn { flex: 1; padding: 10px; border: none; background: transparent; color: #fff; cursor: pointer; font-weight: bold; }
  .nav-btn.activo { background: rgba(255,255,255,0.1); }
  h1 { text-align: center; color: #042490; margin-top: 20px; }
  .detalle { padding: 20px; }
  .producto-imagen { width: 100%; height: 200px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #042490; font-weight: bold; font-size: 24px; margin-bottom: 20px; }
  .precio { font-size: 24px; font-weight: bold; color: #042490; margin: 15px 0; }
  .especificaciones { background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 15px 0; }
  .especificacion { display: flex; justify-content: space-between; margin: 8px 0; }
  button { width: 100%; padding: 12px; background: #042490; color: white; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>

<div class="form-box">
  <div class="nav">
    <button class="nav-btn" onclick="location.href='E2F1.html'">INICIO</button>
    <button class="nav-btn" onclick="location.href='E2F2.html'">CAT√ÅLOGO</button>
    <button class="nav-btn activo" onclick="location.href='E2F3.html'">DETALLE</button>
  </div>

  <div class="detalle" id="detalleProducto">
    <!-- El detalle se carga din√°micamente -->
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  // 1. Recuperamos el ID del producto que el usuario seleccion√≥ en el cat√°logo
  const productoId = localStorage.getItem('productoSeleccionado');

  if (!productoId) {
    alert("No se ha seleccionado ning√∫n producto. Volviendo al cat√°logo.");
    window.location.href = 'E2F2.html';
    return;
  }

  try {
    // 2. Pedimos a la API la informaci√≥n de ESE producto espec√≠fico
    const response = await fetch(`http://127.0.0.1:8000/products/${productoId}`);
    
    if (!response.ok) {
        throw new Error("Producto no encontrado");
    }

    const producto = await response.json();
    
    // 3. Mostramos los datos en pantalla
    mostrarDetalle(producto);

  } catch (error) {
    console.error(error);
    document.getElementById('detalleProducto').innerHTML = 
        '<div style="text-align:center; padding:50px;"><h2>Error al cargar el producto üò¢</h2><button onclick="location.href=\'E2F2.html\'">Volver</button></div>';
  }
});

function mostrarDetalle(producto) {
  const detalle = document.getElementById('detalleProducto');
  
  // L√≥gica de Imagen vs Emoji (igual que en el cat√°logo)
  let imagenHTML = "";
  if (producto.imagen && producto.imagen.startsWith("http")) {
      imagenHTML = `<img src="${producto.imagen}" alt="${producto.nombre}" style="max-width: 100%; max-height: 300px; border-radius: 8px; object-fit: contain;">`;
  } else {
      imagenHTML = `<div style="font-size: 80px;">${producto.imagen || "ü•©"}</div>`;
  }

  // Generamos el HTML de las especificaciones (si las tiene)
  let especificacionesHTML = '';
  if (producto.especificaciones && producto.especificaciones.length > 0) {
      producto.especificaciones.forEach(esp => {
        especificacionesHTML += `<div class="especificacion"><span>${esp.nombre}:</span> <span>${esp.valor}</span></div>`;
      });
  } else {
      especificacionesHTML = '<p style="color:#888; font-style:italic;">Sin especificaciones adicionales.</p>';
  }

  detalle.innerHTML = `
    <h1>${producto.nombre}</h1>
    <div class="producto-imagen" style="background:transparent; height:auto; padding:20px;">
        ${imagenHTML}
    </div>
    <div class="precio">$${producto.precio.toLocaleString()}</div>
    <p style="color:#666; text-align:center; font-size: 1.1em; margin: 20px 0;">${producto.descripcion}</p>
    
    <div class="especificaciones" style="margin-bottom: 30px;">
      <h3 style="color:#042490; border-bottom:1px solid #ddd; padding-bottom:5px;">Detalles</h3>
      ${especificacionesHTML}
    </div>
    
    <button onclick="agregarAlCarrito('${producto._id}')" style="padding: 15px; font-size: 1.1em;">üõí Agregar al Carrito</button>
    <button onclick="location.href='E2F2.html'" style="background:#666; margin-top:10px;">‚Üê Volver al Cat√°logo</button>
  `;
}

function agregarAlCarrito(id) {
  // Aqu√≠ m√°s adelante conectaremos con la l√≥gica real del carrito
  alert(`¬°Producto agregado al carrito! (ID: ${id})`);
}
</script>
</body>
</html>