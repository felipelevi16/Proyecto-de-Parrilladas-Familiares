<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PARRILLADAS FAMILIARES</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f6f5f3, #042490); margin: 0; min-height: 100vh; display: flex; justify-content: center; }
  .form-box { background: #fff; border-radius: 12px; width: 95%; max-width: 1200px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); margin: 20px 0; }
  .nav { display: flex; justify-content: space-around; background: #042490; padding: 10px; }
  .nav-btn { flex: 1; padding: 10px; border: none; background: transparent; color: #fff; cursor: pointer; font-weight: bold; }
  .nav-btn.activo { background: rgba(255,255,255,0.1); }
  h1 { text-align: center; color: #042490; margin-top: 20px; }
  .filtros { display: flex; gap: 10px; padding: 20px; background: #f8f9fa; border-bottom: 1px solid #eee; flex-wrap: wrap; }
  .filtro-select, .buscar-input { padding: 8px; border: 2px solid #ddd; border-radius: 6px; }
  .btn-limpiar { padding: 8px 16px; background: #042490; color: white; border: none; border-radius: 6px; cursor: pointer; }
  #listaProductos { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; padding: 20px; }
  .producto { background: #fdfdfd; border: 1px solid #eee; border-radius: 8px; padding: 15px; text-align: center; cursor: pointer; transition: transform 0.2s; }
  .producto:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
  .producto-imagen { width: 100%; height: 150px; background: #f8f9fa; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: #042490; font-weight: bold; margin-bottom: 10px; }
  .precio { font-weight: bold; color: #042490; font-size: 18px; margin: 10px 0; }
  .producto button { width: 100%; padding: 10px; background: #042490; color: white; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px; }
  .contador { text-align: center; color: #666; margin: 10px; }
  .escenario { display: none; }
  .escenario.activo { display: block; }
  .sin-resultados { text-align: center; padding: 40px; color: #666; }
</style>
</head>
<body>

<div class="form-box">
  <div class="nav">
    <button class="nav-btn" onclick="location.href='E2F1.html'">INICIO</button>
    <button class="nav-btn activo" onclick="location.href='E2F2.html'">CAT츼LOGO</button>
  </div>

  <div id="catalogo" class="escenario activo">
    <h1>PARRILLADAS FAMILIARES DON EDUARDO</h1>
    <p>Cat치logo completo</p>
    
    <div class="filtros">
      <input type="text" class="buscar-input" id="buscarInput" placeholder="Buscar..." onkeyup="filtrarProductos()">
      <select class="filtro-select" id="categoriaFilter" onchange="filtrarProductos()">
        <option value="">Todas</option>
        <option value="carnes">Carnes</option>
        <option value="acompa침amientos">Acompa침amientos</option>
        <option value="bebidas">Bebidas</option>
      </select>
      <button class="btn-limpiar" onclick="limpiarFiltros()">Limpiar</button>
    </div>

    <div class="contador" id="contadorProductos">Mostrando productos</div>
    
    <div id="listaProductos"></div>
  </div>

  <div id="sin-resultados" class="escenario">
    <h1>PARRILLADAS FAMILIARES DON EDUARDO</h1>
    <div class="sin-resultados">
      <h3>No se encontraron productos</h3>
      <button class="btn-limpiar" onclick="mostrarEscenario('catalogo')">Ver Todos</button>
    </div>
  </div>
</div>

<script>
// Referencias
const grid = document.getElementById('listaProductos');
const contador = document.getElementById('contadorProductos');
let productos = []; // Aqu칤 guardaremos los datos reales que lleguen de la API

// 1. Cargar productos al iniciar la p치gina
document.addEventListener('DOMContentLoaded', async () => {
  try {
    const response = await fetch('http://127.0.0.1:8000/products');
    productos = await response.json();
    
    mostrarProductos(productos);
  } catch (error) {
    console.error("Error cargando productos:", error);
    grid.innerHTML = '<p style="color:red; text-align:center;">Error al cargar el cat치logo. Revisa la conexi칩n.</p>';
  }
});

// 2. Funci칩n para dibujar los productos en pantalla
function mostrarProductos(lista) {
  grid.innerHTML = '';
  contador.textContent = `${lista.length} productos encontrados`;

  if (lista.length === 0) {
    grid.innerHTML = '<div class="sin-resultados"><h3>No hay productos disponibles</h3></div>';
    return;
  }

  lista.forEach(p => {
    let imagenHTML = "";
    
    if (p.imagen && p.imagen.startsWith("http")) {
        // Si empieza con http, es una FOTO REAL
        imagenHTML = `<img src="${p.imagen}" alt="${p.nombre}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 6px;">`;
    } else {
        // Si no, asumimos que es un EMOJI
        imagenHTML = `<div style="font-size: 40px; line-height: 150px;">${p.imagen || "游볼"}</div>`;
    }
    
    grid.innerHTML += `
      <div class="producto" onclick="verDetalle('${p._id}')">
        <div class="producto-imagen" style="height: 150px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
            ${imagenHTML}
        </div>
        <h3>${p.nombre}</h3>
        <p>${p.descripcion}</p>
        <div class="precio">$${p.precio.toLocaleString()}</div>
        <button onclick="event.stopPropagation(); agregarAlCarrito('${p._id}')">Agregar al Carrito</button>
      </div>
    `;
  });
}

function verDetalle(id) {
  localStorage.setItem('productoSeleccionado', id);
  // 춰Ahora s칤 redirigimos de verdad!
  window.location.href = 'E2F3.html'; 
}

function agregarAlCarrito(id) {
  alert(`Producto ${id} agregado al carrito (Simulaci칩n)`);
}
</script>
</body>
</html>