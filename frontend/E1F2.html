<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bienvenido - Parrilladas Don Eduardo</title>
<style>
  :root {
    --primary: #042490;
    --primary-gradient: linear-gradient(135deg, #021B79 0%, #0575E6 100%);
    --secondary: #FFFFFF;
    --text-dark: #1E293B;
    --text-light: #64748B;
    --bg-page: #F8FAFC;
    --glass: rgba(255, 255, 255, 0.95);
  }

  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--bg-page);
    background-image: radial-gradient(#E2E8F0 1px, transparent 1px);
    background-size: 20px 20px; /* Patr√≥n de puntos sutil */
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--text-dark);
  }

  .form-box {
    background: var(--secondary);
    padding: 40px;
    border-radius: 24px;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 20px 50px rgba(4, 36, 144, 0.1);
    text-align: center;
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.8);
  }

  /* Efecto de luz superior */
  .form-box::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px;
    background: var(--primary-gradient);
  }

  h1 {
    color: var(--primary);
    font-size: 24px;
    font-weight: 800;
    margin-bottom: 8px;
    letter-spacing: -0.5px;
  }

  p {
    color: var(--text-light);
    font-size: 14px;
    margin-bottom: 30px;
  }

  /* --- SWITCH DE PESTA√ëAS --- */
  .nav {
    display: flex;
    background: #F1F5F9;
    padding: 5px;
    border-radius: 12px;
    margin-bottom: 30px;
    position: relative;
  }

  .nav-btn {
    flex: 1;
    padding: 10px;
    border: none;
    background: transparent;
    color: var(--text-light);
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    border-radius: 10px;
    transition: all 0.3s ease;
    z-index: 1;
  }

  .nav-btn.activo {
    background: white;
    color: var(--primary);
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  /* --- FORMULARIOS --- */
  form {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  input {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #F1F5F9;
    border-radius: 12px;
    font-size: 14px;
    color: var(--text-dark);
    transition: 0.3s;
    background: #FAFAFA;
    box-sizing: border-box; /* Importante para que el padding no rompa el ancho */
  }

  input:focus {
    outline: none;
    border-color: var(--primary);
    background: white;
    box-shadow: 0 0 0 4px rgba(4, 36, 144, 0.05);
  }

  /* Checkbox personalizado */
  .checkbox-container {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: var(--text-light);
    text-align: left;
    width: 100%;
    margin-top: 5px;
  }
  input[type="checkbox"] { width: 16px; height: 16px; accent-color: var(--primary); }

  /* Bot√≥n Principal */
  button[type="submit"] {
    width: 100%;
    padding: 16px;
    margin-top: 10px;
    border: none;
    border-radius: 14px;
    background: var(--primary-gradient);
    color: white;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 10px 20px rgba(4, 36, 144, 0.2);
  }

  button[type="submit"]:hover {
    transform: translateY(-2px);
    box-shadow: 0 15px 30px rgba(4, 36, 144, 0.3);
  }

  /* Enlaces y Errores */
  .forgot-pass {
    display: block;
    margin-top: 20px;
    font-size: 13px;
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
  }
  
  small { color: #EF4444; font-size: 12px; text-align: left; display: block; margin-top: -10px; margin-bottom: 5px; }

  .mensaje {
    margin-top: 20px; padding: 12px; border-radius: 10px; font-size: 14px;
    font-weight: 600; display: none; text-align: center;
  }
  .exito { background: #DCFCE7; color: #166534; border: 1px solid #86EFAC; }
  .error { background: #FEE2E2; color: #991B1B; border: 1px solid #FCA5A5; }

  .formulario { display: none; animation: fadeIn 0.4s ease; }
  .formulario.activo { display: flex; flex-direction: column; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<div class="form-box">
  <div class="logo-area" style="margin-bottom: 20px; font-size: 40px;">üî•</div>
  <h1>Parrilladas Don Eduardo</h1>
  <p>El aut√©ntico sabor de la parrilla</p>

  <div class="nav">
    <button class="nav-btn activo" onclick="mostrarForm('login')">Iniciar Sesi√≥n</button>
    <button class="nav-btn" onclick="mostrarForm('registro')">Crear Cuenta</button>
  </div>
  
  <div id="login" class="formulario activo">
    <form id="loginForm">
      <input type="email" id="loginEmail" placeholder="Correo electr√≥nico" required>
      <input type="password" id="loginPassword" placeholder="Contrase√±a" required>
      
      <label class="checkbox-container">
        <input type="checkbox" id="recordar"> Recordarme
      </label>
      
      <button type="submit">Ingresar</button>
    </form>
    <a href="E1F3.html" class="forgot-pass">¬øOlvidaste tu contrase√±a?</a>
  </div>

  <div id="registro" class="formulario">
    <form id="registroForm">
      <input type="email" id="regEmail" placeholder="Tu correo electr√≥nico" required>
      <small id="error-email"></small>
      
      <input type="password" id="regPassword" placeholder="Crea una contrase√±a" required>
      <small id="error-password"></small>
      
      <input type="password" id="regConfirm" placeholder="Confirma tu contrase√±a" required>
      <small id="error-confirm"></small>
      
      <label class="checkbox-container">
        <input type="checkbox" id="regTerminos"> Acepto los t√©rminos y condiciones
      </label>
      <small id="error-terminos"></small>
      
      <button type="submit">Crear Cuenta</button>
    </form>
  </div>
  
  <div id="mensaje" class="mensaje"></div>
</div>

<script>
// --- L√ìGICA DE UI ---
function mostrarForm(tipo) {
  document.querySelectorAll('.formulario').forEach(f => f.classList.remove('activo'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('activo'));
  
  document.getElementById(tipo).classList.add('activo');
  // Buscar el bot√≥n correspondiente
  const buttons = document.querySelectorAll('.nav-btn');
  if(tipo === 'login') buttons[0].classList.add('activo');
  else buttons[1].classList.add('activo');
  
  document.getElementById('mensaje').style.display = 'none';
}

// --- VALIDACIONES ---
function validarEmail(e){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);}
function validarPass(p){return /^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{8,}$/.test(p);}
function err(id,txt){document.getElementById(id).textContent=txt;}
function limpiarErrores(){["email","password","confirm","terminos"].forEach(c=>err("error-"+c,""));}

const msj = document.getElementById("mensaje");

// --- LOGIN (CON REDIRECCI√ìN INTELIGENTE) ---
document.getElementById("loginForm").addEventListener("submit", async e => {
  e.preventDefault(); 
  msj.style.display = 'none';
  
  const emailVal = document.getElementById("loginEmail").value.trim();
  const passwordVal = document.getElementById("loginPassword").value;

  // Feedback visual inmediato
  const btn = e.target.querySelector('button');
  const btnText = btn.textContent;
  btn.textContent = "Verificando...";
  btn.disabled = true;

  try {
    const response = await fetch('http://127.0.0.1:8000/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: emailVal, password: passwordVal })
    });

    const resultado = await response.json();

    if (response.ok) {
      msj.textContent = "¬°Bienvenido! Entrando..."; 
      msj.className = "mensaje exito";
      msj.style.display = "block";
      
      localStorage.setItem('userEmail', resultado.email);
      localStorage.setItem('userRole', resultado.role);

      setTimeout(() => {
        if (resultado.role === 'admin') {
            window.location.href = "E6F1.html"; 
        } else {
            window.location.href = "E2F1.html"; 
        }
      }, 1000);
      
    } else {
      msj.textContent = resultado.detail || "Credenciales incorrectas";
      msj.className = "mensaje error";
      msj.style.display = "block";
      btn.textContent = btnText;
      btn.disabled = false;
    }
  } catch (error) {
    msj.textContent = "Error de conexi√≥n";
    msj.className = "mensaje error";
    msj.style.display = "block";
    btn.textContent = btnText;
    btn.disabled = false;
  }
});

// --- REGISTRO ---
document.getElementById("registroForm").addEventListener("submit", async e => {
  e.preventDefault(); 
  limpiarErrores(); 
  msj.style.display="none";

  const emailVal = document.getElementById("regEmail").value.trim();
  const passVal = document.getElementById("regPassword").value;
  const confVal = document.getElementById("regConfirm").value;
  const termVal = document.getElementById("regTerminos").checked;
  
  let errores = false;

  if(!emailVal || !validarEmail(emailVal)){ err("error-email","Correo inv√°lido"); errores=true; }
  if(!passVal || !validarPass(passVal)){ err("error-password","M√≠n 8 caracteres, 1 may√∫scula, 1 n√∫mero"); errores=true; }
  if(confVal !== passVal){ err("error-confirm","No coinciden"); errores=true; }
  if(!termVal){ err("error-terminos","Debes aceptar t√©rminos"); errores=true; }
  
  if(errores) return;

  try {
    const response = await fetch('http://127.0.0.1:8000/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: emailVal,
        password: passVal,
        confirm: confVal,
        terminos: termVal
      })
    });

    const resultado = await response.json();

    if (response.ok) {
      msj.textContent = "¬°Cuenta creada con √©xito!";
      msj.className = "mensaje exito"; 
      msj.style.display = "block";
      document.getElementById("registroForm").reset();
      
      setTimeout(() => {
          window.location.href = "E2F1.html";
      }, 2000);
      
    } else {
      msj.textContent = resultado.detail;
      msj.className = "mensaje error"; 
      msj.style.display = "block";
    }
  } catch (error) {
    msj.textContent = "Error de conexi√≥n.";
    msj.className = "mensaje error"; 
    msj.style.display = "block";
  }
});
</script>
</body>
</html>